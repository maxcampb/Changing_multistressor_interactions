data = psii_dat,
method = "REML")
view(xdiuron_light2)
#Select the best model
m1 <- lmer(lncelld ~ Light*hours_fact + offset(lnt0) + (1|block),
data = lightdat)
qqnorm(resid(m1))
qqline(resid(m1))
m2 <- lmer(lncelld ~ Light+hours_fact + offset(lnt0) + (1|block),
data = lightdat)
anova(m1, m2) #likelihood ratio test, tells me if interaction between light and hours
View(diurondat)
#
# Figure 2A - growth
#
xdiuron_light3$Diuron <- factor(xdiuron_light2$Diuron)
#
# Figure 2A - growth
#
xdiuron_light3$Diuron <- factor(xdiuron_light2$Diuron)
files <- list.files(path = "Data", pattern = "diuron_light_rep", full.names = TRUE)
xdiuron_light <- lapply(files, function(x) read.csv(x)) %>%
bind_rows(.id = "id") %>% within(hours[hours == 0.3] <- 0.33)
xdiuron_light2 <- xdiuron_light  %>%
filter(Replicate == "AVERAGE", Diuron != "Blank", hours >= 0) %>%
group_by(hours, Light, Diuron, id) %>%
summarise(Absorbance = mean(Absorbance), X = paste(X, collapse = " ")) %>% ungroup() %>%
within({
Diuron_num <-  case_when(Diuron == "AlgaeControl" ~ 0,
Diuron == "MeOH" ~ 0,
TRUE ~ as.numeric(Diuron)
)
Light_num <-  as.numeric(Light)
block <-  factor(id)
hours_fact <- factor(hours)
celld <- 4179.6 * Absorbance - 172.48
t0 <- ifelse(hours == 0, celld, NA)
}) %>% group_by(Light, Diuron, id ) %>% fill(t0) %>%
ungroup() %>%
mutate(sample_id = factor(gsub("."," ", x = paste(Diuron, Light, block), fixed = TRUE))) %>%
filter(hours != 0, Diuron != "MeOH") %>%
mutate(Diuron_fact = factor(ifelse(Diuron == "AlgaeControl", "0", Diuron)))  %>%
mutate(lncelld = log(celld),
lnt0 = log(t0))
#
# Figure 2A - growth
#
xdiuron_light3$Diuron <- factor(xdiuron_light2$Diuron)
files <- list.files(path = "Data", pattern = "diuron_light_rep", full.names = TRUE)
xdiuron_light <- lapply(files, function(x) read.csv(x)) %>%
bind_rows(.id = "id") %>% within(hours[hours == 0.3] <- 0.33)
xdiuron_light2 <- xdiuron_light  %>%
filter(Replicate == "AVERAGE", Diuron != "Blank", hours >= 0) %>%
group_by(hours, Light, Diuron, id) %>%
summarise(Absorbance = mean(Absorbance), X = paste(X, collapse = " ")) %>% ungroup() %>%
within({
Diuron_num <-  case_when(Diuron == "AlgaeControl" ~ 0,
Diuron == "MeOH" ~ 0,
TRUE ~ as.numeric(Diuron)
)
Light_num <-  as.numeric(Light)
block <-  factor(id)
hours_fact <- factor(hours)
celld <- 4179.6 * Absorbance - 172.48
t0 <- ifelse(hours == 0, celld, NA)
}) %>% group_by(Light, Diuron, id ) %>% fill(t0) %>%
ungroup() %>%
mutate(sample_id = factor(gsub("."," ", x = paste(Diuron, Light, block), fixed = TRUE))) %>%
filter(hours != 0, Diuron != "MeOH") %>%
mutate(Diuron_fact = factor(ifelse(Diuron == "AlgaeControl", "0", Diuron)))  %>%
mutate(lncelld = log(celld),
lnt0 = log(t0))
#
# Figure 2A - growth
#
xdiuron_light2$Diuron <- factor(xdiuron_light2$Diuron)
xdiuron_light2$Diuron <- relevel(xdiuron_light2$Diuron, ref = "AlgaeControl")
view(xdiuron_light2)
# Diuron, optimal light
diurondat <- filter(xdiuron_light2, Light == "80")
nrow(diurondat)
view(diurondat)
view(diurondat)
#Select the best model
m1 <- lmer(lncelld ~ Light*hours_fact + offset(lnt0) + (1|block),
data = lightdat)
#Select the best model
m1 <- lmer(lncelld ~ Light*hours_fact + offset(lnt0) + (1|block),
data = diurondat)
#Select the best model
m1 <- lmer(lncelld ~ Diuron*hours_fact + offset(lnt0) + (1|block),
data = diurondat)
qqnorm(resid(m1))
qqline(resid(m1))
m2 <- lmer(lncelld ~ Diuron+hours_fact + offset(lnt0) + (1|block),
data = diurondat)
anova(m1, m2) #likelihood ratio test, tells me if interaction between light and hours
# Read in data
psii_dat <- read_csv("Data/diuron_light_PSII_long_NEW.csv") %>%
rename(hours = `Time (hours)`, Diuron = `Diuron (ug/L)`,
Light_num = `Light (u mol photons m/s/)`, block = Block) %>%
group_by(hours, Light_num, Diuron, block) %>%
summarise(photo_inhib = mean(`Photosynthetic inhibition (%)`),
Yield = mean(`Y(II)`),
Yield_C = mean(`Average Y (controls)`, na.rm = TRUE)) %>%
within({
hours[hours == 0.3] <- 0.33
Diuron_num <-  case_when(Diuron == "Control" ~ 0,
Diuron == "MeOH" ~ 0,
TRUE ~ as.numeric(Diuron)
)
block <-  factor(as.character(block))
hours_fact <- factor(hours)
t0 <- ifelse(hours == 0, Yield, NA)
inhibt0 <- ifelse(hours == 0, photo_inhib, NA)
treatment <- factor(paste(Diuron, Light_num, sep = "_"))
}) %>% group_by(Light_num, Diuron, block ) %>%
fill(t0, inhibt0) %>% ungroup() %>%
mutate(sample_id = factor(gsub("."," ", x = paste(Diuron, Light_num, block), fixed = TRUE)))
view(psii_dat)
#
##### Figure 2A - photosynthesis (diuron, optimal light)
#
psii_dat$Light_num <- factor(psii_dat2$Light_num)
#
##### Figure 2A - photosynthesis (diuron, optimal light)
#
psii_dat$Light <- factor(psii_dat2$Light_num)
#
##### Figure 2A - photosynthesis (diuron, optimal light)
#
psii_dat$Light_num <- factor(psii_dat$Light_num)
psii_dat$Light_num <- relevel(psii_dat$Light_num, ref = "80")
levels(psii_dat$$hours_fact)
levels(psii_dat$hours_fact)
view(psii_dat)
# Diuron, optimal light
diurondatphoto <- filter(psii_dat, Light_num == "80")
nrow(diurondatphoto)
view(diurondatphoto)
#Select the best model
m5 <- lmer(Yield ~ Diuron*hours_fact + offset(t0) + (1|block),
data = psii_dat)
qqnorm(resid(m5))
qqline(resid(m5))
m5 <- lmer(Yield ~ Diuron+hours_fact + offset(t0) + (1|block),
data = psii_dat)
#Select the best model
m5 <- lmer(Yield ~ Diuron*hours_fact + offset(t0) + (1|block),
data = psii_dat)
qqnorm(resid(m5))
qqline(resid(m5))
m6 <- lmer(Yield ~ Diuron+hours_fact + offset(t0) + (1|block),
data = psii_dat)
anova(m5, m6) #likelihood ratio test, tells me if interaction between light and hours
summary(m3)
summary(m5)
# Read in data
psii_dat <- read_csv("Data/diuron_light_PSII_long_NEW.csv") %>%
rename(hours = `Time (hours)`, Diuron = `Diuron (ug/L)`,
Light_num = `Light (u mol photons m/s/)`, block = Block) %>%
group_by(hours, Light_num, Diuron, block) %>%
summarise(photo_inhib = mean(`Photosynthetic inhibition (%)`),
Yield = mean(`Y(II)`),
Yield_C = mean(`Average Y (controls)`, na.rm = TRUE)) %>%
within({
hours[hours == 0.3] <- 0.33
Diuron_num <-  case_when(Diuron == "Control" ~ 0,
Diuron == "MeOH" ~ 0,
TRUE ~ as.numeric(Diuron)
)
block <-  factor(as.character(block))
hours_fact <- factor(hours)
t0 <- ifelse(hours == 0, Yield, NA)
inhibt0 <- ifelse(hours == 0, photo_inhib, NA)
treatment <- factor(paste(Diuron, Light_num, sep = "_"))
}) %>% group_by(Light_num, Diuron, block ) %>%
fill(t0, inhibt0) %>% ungroup() %>%
mutate(sample_id = factor(gsub("."," ", x = paste(Diuron, Light_num, block), fixed = TRUE)))
view(psii_dat)
#
##### Figure 2A - photosynthesis (diuron, optimal light)
#
psii_dat$Diuron <- factor(psii_dat$Diuron)
psii_dat$Diuron <- relevel(psii_dat$Diuron, ref = "AlgaeControl")
psii_dat$Diuron <- relevel(psii_dat$Diuron, ref = "Control")
levels(psii_dat$hours_fact)
# Diuron, optimal light
diurondatphoto <- filter(psii_dat, Light == "80")
# Diuron, optimal light
diurondatphoto <- filter(psii_dat, Light_num == "80")
nrow(diurondatphoto)
view(diurondatphoto)
#Select the best model
m5 <- lmer(Yield ~ Diuron*hours_fact + offset(lnt0) + (1|block),
data = diurondatphoto)
qqnorm(resid(m5))
qqline(resid(m5))
#Select the best model
m5 <- lmer(Yield ~ Diuron*hours_fact + offset(lnt0) + (1|block),
data = diurondatphoto)
#Select the best model
m5 <- lmer(Yield ~ Diuron*hours_fact + offset(t0) + (1|block),
data = diurondatphoto)
qqnorm(resid(m5))
qqline(resid(m5))
m5 <- lmer(Yield ~ Diuron+hours_fact + offset(t0) + (1|block),
data = diurondatphoto)
#Select the best model
m5 <- lmer(Yield ~ Diuron*hours_fact + offset(t0) + (1|block),
data = diurondatphoto)
qqnorm(resid(m5))
qqline(resid(m5))
m6 <- lmer(Yield ~ Diuron+hours_fact + offset(t0) + (1|block),
data = diurondatphoto)
anova(m5, m6) #likelihood ratio test, tells me if interaction between light and hours
# Read in data
psii_dat <- read_csv("Data/diuron_light_PSII_long_NEW.csv") %>%
rename(hours = `Time (hours)`, Diuron = `Diuron (ug/L)`,
Light_num = `Light (u mol photons m/s/)`, block = Block) %>%
group_by(hours, Light_num, Diuron, block) %>%
summarise(photo_inhib = mean(`Photosynthetic inhibition (%)`),
Yield = mean(`Y(II)`),
Yield_C = mean(`Average Y (controls)`, na.rm = TRUE)) %>%
within({
hours[hours == 0.3] <- 0.33
Diuron_num <-  case_when(Diuron == "Control" ~ 0,
Diuron == "MeOH" ~ 0,
TRUE ~ as.numeric(Diuron)
)
block <-  factor(as.character(block))
hours_fact <- factor(hours)
t0 <- ifelse(hours == 0, Yield, NA)
inhibt0 <- ifelse(hours == 0, photo_inhib, NA)
treatment <- factor(paste(Diuron, Light_num, sep = "_"))
}) %>% group_by(Light_num, Diuron, block ) %>%
fill(t0, inhibt0) %>% ungroup() %>%
mutate(sample_id = factor(gsub("."," ", x = paste(Diuron, Light_num, block), fixed = TRUE)))
#
##### Figure 2B - photosynthesis (diuron, optimal light)
#
psii_dat$Light_num <- factor(psii_dat$Light_num)
psii_dat$Light_num <- relevel(psii_dat$Light_num, ref = "80")
levels(psii_dat$hours_fact)
view(psii_dat)
# Light, no diuron
lightdatphoto <- filter(psii_dat, Light_num == "80")
nrow(lightdatphoto)
view(lightdatphoto)
#Select the best model
m7 <- lmer(Yield ~ Light_num*hours_fact + offset(t0) + (1|block),
data = lightdatphoto)
# Light, no diuron
lightdatphoto <- filter(psii_dat, Light_num == "80")
nrow(lightdatphoto)
view(lightdatphoto)
#Select the best model
m7 <- lmer(Yield ~ Light_num*hours_fact + offset(t0) + (1|block),
data = lightdatphoto)
view(lightdatphoto)
#Select the best model
m7 <- lmer(Yield ~ Light*hours_fact + offset(t0) + (1|block),
data = lightdatphoto)
#Select the best model
m7 <- lmer(Yield ~ Light_num*hours_fact + offset(t0) + (1|block),
data = lightdatphoto)
m8 <- lmer(Yield ~ Light_num+hours_fact + offset(t0) + (1|block),
data = lightdatphoto)
#
##### Dose response curves
#
view(psii_dat)
library(mgcv)
library(visreg)
mDR <- gam(Yield ~ s(Diuron, by = Light_num, k = 4) + Light_num +
offset(t0),
data = psii_dat,
method = "REML")
files <- list.files(path = "Data", pattern = "diuron_light_rep", full.names = TRUE)
xdiuron_light <- lapply(files, function(x) read.csv(x)) %>%
bind_rows(.id = "id") %>% within(hours[hours == 0.3] <- 0.33)
xdiuron_light2 <- xdiuron_light  %>%
filter(Replicate == "AVERAGE", Diuron != "Blank", hours >= 0) %>%
group_by(hours, Light, Diuron, id) %>%
summarise(Absorbance = mean(Absorbance), X = paste(X, collapse = " ")) %>% ungroup() %>%
within({
Diuron_num <-  case_when(Diuron == "AlgaeControl" ~ 0,
Diuron == "MeOH" ~ 0,
TRUE ~ as.numeric(Diuron)
)
Light_num <-  as.numeric(Light)
block <-  factor(id)
hours_fact <- factor(hours)
celld <- 4179.6 * Absorbance - 172.48
t0 <- ifelse(hours == 0, celld, NA)
}) %>% group_by(Light, Diuron, id ) %>% fill(t0) %>%
ungroup() %>%
mutate(sample_id = factor(gsub("."," ", x = paste(Diuron, Light, block), fixed = TRUE))) %>%
filter(hours != 0, Diuron != "MeOH") %>%
mutate(Diuron_fact = factor(ifelse(Diuron == "AlgaeControl", "0", Diuron)))  %>%
mutate(lncelld = log(celld),
lnt0 = log(t0))
#
##### Figure 2A - growth (diuron, optimal light)
#
xdiuron_light2$Diuron <- factor(xdiuron_light2$Diuron)
xdiuron_light2$Diuron <- relevel(xdiuron_light2$Diuron, ref = "AlgaeControl")
levels(xdiuron_light2$hours_fact)
view(xdiuron_light2)
# Diuron, optimal light
diurondat <- filter(xdiuron_light2, Light == "80")
nrow(diurondat)
view(diurondat)
#Select the best model
m1 <- lmer(lncelld ~ Diuron*hours_fact + offset(lnt0) + (1|block),
data = diurondat)
qqnorm(resid(m1))
qqline(resid(m1))
m2 <- lmer(lncelld ~ Diuron+hours_fact + offset(lnt0) + (1|block),
data = diurondat)
anova(m1, m2) #likelihood ratio test, tells me if interaction between light and hours
summary(m1)
#
##### Figure 2B - growth (light, no diuron)
#
xdiuron_light2$Light <- factor(xdiuron_light2$Light)
xdiuron_light2$Light <- relevel(xdiuron_light2$Light, ref = "80")
levels(xdiuron_light2$hours_fact)
view(xdiuron_light2)
lightdat <- filter(xdiuron_light2, Diuron == "AlgaeControl")
nrow(lightdat)
view(lightdat)
#Select the best model
m3 <- lmer(lncelld ~ Light*hours_fact + offset(lnt0) + (1|block),
data = lightdat)
qqnorm(resid(m3))
qqline(resid(m3))
m4 <- lmer(lncelld ~ Light+hours_fact + offset(lnt0) + (1|block),
data = lightdat)
anova(m3, m4) #likelihood ratio test, tells me if interaction between light and hours
summary(m3)
# Compare differences with "profile confidence intervals"
confint(m3)
#
##### Dose response curves
#
view(xdiuron_light2)
library(mgcv)
library(visreg)
mDR <- gam(lncelld ~ s(Diuron_num, by = Light, k = 4) + Light +
offset(lnt0),
data = xdiuron_light2,
method = "REML")
summary(mDR)
# Read in data
psii_dat <- read_csv("Data/diuron_light_PSII_long_NEW.csv") %>%
rename(hours = `Time (hours)`, Diuron = `Diuron (ug/L)`,
Light_num = `Light (u mol photons m/s/)`, block = Block) %>%
group_by(hours, Light_num, Diuron, block) %>%
summarise(photo_inhib = mean(`Photosynthetic inhibition (%)`),
Yield = mean(`Y(II)`),
Yield_C = mean(`Average Y (controls)`, na.rm = TRUE)) %>%
within({
hours[hours == 0.3] <- 0.33
Diuron_num <-  case_when(Diuron == "Control" ~ 0,
Diuron == "MeOH" ~ 0,
TRUE ~ as.numeric(Diuron)
)
block <-  factor(as.character(block))
hours_fact <- factor(hours)
t0 <- ifelse(hours == 0, Yield, NA)
inhibt0 <- ifelse(hours == 0, photo_inhib, NA)
treatment <- factor(paste(Diuron, Light_num, sep = "_"))
}) %>% group_by(Light_num, Diuron, block ) %>%
fill(t0, inhibt0) %>% ungroup() %>%
mutate(sample_id = factor(gsub("."," ", x = paste(Diuron, Light_num, block), fixed = TRUE)))
view(psii_dat)
#
##### Figure 2A - photosynthesis (diuron, optimal light)
#
psii_dat$Diuron <- factor(psii_dat$Diuron)
psii_dat$Diuron <- relevel(psii_dat$Diuron, ref = "Control")
levels(psii_dat$hours_fact)
view(psii_dat)
# Diuron, optimal light
diurondatphoto <- filter(psii_dat, Light_num == "80")
nrow(diurondatphoto)
view(diurondatphoto)
#Select the best model
m5 <- lmer(Yield ~ Diuron*hours_fact + offset(t0) + (1|block),
data = diurondatphoto)
qqnorm(resid(m5))
qqline(resid(m5))
m6 <- lmer(Yield ~ Diuron+hours_fact + offset(t0) + (1|block),
data = diurondatphoto)
anova(m5, m6) #likelihood ratio test, tells me if interaction between light and hours
#
##### Figure 2B - photosynthesis (diuron, optimal light)
#
psii_dat$Light_num <- factor(psii_dat$Light_num)
psii_dat$Light_num <- relevel(psii_dat$Light_num, ref = "80")
levels(psii_dat$hours_fact)
view(psii_dat)
# Light, no diuron
lightdatphoto <- filter(psii_dat, Diuron == "Control")
nrow(lightdatphoto)
view(lightdatphoto)
#Select the best model ######### MODELS DON'T WORK???
m7 <- lmer(Yield ~ Light_num*hours_fact + offset(t0) + (1|block),
data = lightdatphoto)
qqnorm(resid(m7))
qqline(resid(m7))
m8 <- lmer(Yield ~ Light_num+hours_fact + offset(t0) + (1|block),
data = lightdatphoto)
anova(m5, m6) #likelihood ratio test, tells me if interaction between light and hours
anova(m7, m8) #likelihood ratio test, tells me if interaction between light and hours
#
##### Dose response curves
#
view(psii_dat)
library(mgcv)
library(visreg)
mDR <- gam(Yield ~ s(Diuron_num, by = Light_num, k = 4) + Light_num +
offset(t0),
data = psii_dat,
method = "REML")
summary(mDR)
#
##### Dose response curves
#
view(xdiuron_light2)
library(mgcv)
library(visreg)
mDR <- gam(lncelld ~ s(Diuron_num, by = Light, k = 4) + Light +
offset(lnt0),
data = xdiuron_light2,
method = "REML")
summary(mDR)
visreg(mDR, xvar = "Diuron_num", by = "Light")
files <- list.files(path = "Data", pattern = "diuron_light_rep", full.names = TRUE)
xdiuron_light <- lapply(files, function(x) read.csv(x)) %>%
bind_rows(.id = "id") %>% within(hours[hours == 0.3] <- 0.33)
xdiuron_light2 <- xdiuron_light  %>%
filter(Replicate == "AVERAGE", Diuron != "Blank", hours >= 0) %>%
group_by(hours, Light, Diuron, id) %>%
summarise(Absorbance = mean(Absorbance), X = paste(X, collapse = " ")) %>% ungroup() %>%
within({
Diuron_num <-  case_when(Diuron == "AlgaeControl" ~ 0,
Diuron == "MeOH" ~ 0,
TRUE ~ as.numeric(Diuron)
)
Light_num <-  as.numeric(Light)
block <-  factor(id)
hours_fact <- factor(hours)
celld <- 4179.6 * Absorbance - 172.48
t0 <- ifelse(hours == 0, celld, NA)
}) %>% group_by(Light, Diuron, id ) %>% fill(t0) %>%
ungroup() %>%
mutate(sample_id = factor(gsub("."," ", x = paste(Diuron, Light, block), fixed = TRUE))) %>%
filter(hours != 0, Diuron != "MeOH") %>%
mutate(Diuron_fact = factor(ifelse(Diuron == "AlgaeControl", "0", Diuron)))  %>%
mutate(lncelld = log(celld),
lnt0 = log(t0))
#
##### Figure 2A - growth (diuron, optimal light)
#
xdiuron_light2$Diuron <- factor(xdiuron_light2$Diuron)
xdiuron_light2$Diuron <- relevel(xdiuron_light2$Diuron, ref = "AlgaeControl")
levels(xdiuron_light2$hours_fact)
view(xdiuron_light2)
# Diuron, optimal light
diurondat <- filter(xdiuron_light2, Light == "80")
nrow(diurondat)
view(diurondat)
#Select the best model
m1 <- lmer(lncelld ~ Diuron*hours_fact + offset(lnt0) + (1|block),
data = diurondat)
qqnorm(resid(m1))
qqline(resid(m1))
m2 <- lmer(lncelld ~ Diuron+hours_fact + offset(lnt0) + (1|block),
data = diurondat)
anova(m1, m2) #likelihood ratio test, tells me if interaction between light and hours
summary(m1)
#
##### Figure 2B - growth (light, no diuron)
#
xdiuron_light2$Light <- factor(xdiuron_light2$Light)
xdiuron_light2$Light <- relevel(xdiuron_light2$Light, ref = "80")
levels(xdiuron_light2$hours_fact)
view(xdiuron_light2)
lightdat <- filter(xdiuron_light2, Diuron == "AlgaeControl")
nrow(lightdat)
view(lightdat)
#Select the best model
m3 <- lmer(lncelld ~ Light*hours_fact + offset(lnt0) + (1|block),
data = lightdat)
qqnorm(resid(m3))
qqline(resid(m3))
m4 <- lmer(lncelld ~ Light+hours_fact + offset(lnt0) + (1|block),
data = lightdat)
anova(m3, m4) #likelihood ratio test, tells me if interaction between light and hours
#
##### Dose response curves
#
view(xdiuron_light2)
library(mgcv)
library(visreg)
mDR <- gam(lncelld ~ s(Diuron_num, by = Light, k = 4) + Light +
offset(lnt0),
data = xdiuron_light2,
method = "REML")
summary(mDR)
